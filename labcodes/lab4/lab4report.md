##lab4 report
#####2012011330 闫昊
***

### 练习一  分配并初始化一个进程控制块

> 实验设计
1. 调用kmalloc分配proc_struct
2. state、pid、cr3需要特殊处理，其余初始化为0，使用memset

####proc_struct中struct context context和struct trapframe *tf成员变量含义和在本实验中的作用：context保存了进程切换时proc的寄存器，trapframe保存了程序的段信息、栈信息，以及中断时的中断信息


###练习二 为新创建的内核线程分配资源

> 设计实现
1. 调用alloc_proc，首先获得一块用户信息块。
2. 为进程分配一个内核栈。
3. 复制原进程的内存管理信息到新进程（但内核线程不必做此事）
4. 复制原进程上下文到新进程
5. 将新进程添加到进程列表
6. 唤醒新进程
7. 返回新进程号

> ucore给进程中的每一个fork的线程赋予一个唯一的id，但是在不同进程之间，这个id并不唯一。

###练习三 阅读代码，理解 proc_run 函数和它调用的函数如何完成进程切换的。

>这个函数的作用是切换到next进程去执行
* 第一步，首先是关闭中断

* 第二步，切换进程指针，
* 第三步，切换内核堆栈
* 第四步，载入页表
* 第五部，载入上下文

* 最后，重新开启中断

* 创建和执行了两个内核线程

* local_intr_save()和local_intr_restore()两个函数的作用是关闭中断和开启中断

* 这里关闭中断的作用是确保操作是原子操作，不会被中断打断